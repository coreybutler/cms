/**
 * cms v0.0.0
 * Author: Corey Butler
 * Built on 01-09-2014
 * Copyright (c) 2014, Ecor Ventures, LLC. All Rights Reserved.
 * http://ecorventures.com
 */
(function(){var a,b,c;"undefined"!=typeof exports?(a=require("xmlhttprequest").XMLHttpRequest,c=require("underscore"),b=require("./lib/base64.js")):(c=window._,b=window.Base64,b={encode:function(a){return window.btoa(unescape(encodeURIComponent(a)))}}),"undefined"!=typeof window&&"undefined"!=typeof window.XMLHttpRequest&&(a=window.XMLHttpRequest);var d="https://api.github.com",e=function(f){function g(c,e,g,h,i,j){function k(){var a=e.indexOf("//")>=0?e:d+e;return a+(/\?/.test(a)?"&":"?")+(new Date).getTime()}var l=new a;return i||(l.dataType="json"),l.open(c,k(),!j),j||(l.onreadystatechange=function(){4==this.readyState&&(this.status>=200&&this.status<300||304===this.status?h(null,i?this.responseText:this.responseText?JSON.parse(this.responseText):!0,this):h({path:e,request:this,error:this.status}))}),l.setRequestHeader("Accept","application/vnd.github.raw+json"),l.setRequestHeader("Content-Type","application/json;charset=UTF-8"),(f.token||f.username&&f.password)&&l.setRequestHeader("Authorization",f.token?"token "+f.token:"Basic "+b.encode(f.username+":"+f.password)),g?l.send(JSON.stringify(g)):l.send(),j?l.response:void 0}function h(a,b){var d=[];!function e(){g("GET",a,null,function(f,g,h){if(f)return b(f);d.push.apply(d,g);var i=(h.getResponseHeader("link")||"").split(/\s*,\s*/g),j=c.find(i,function(a){return/rel="next"/.test(a)});j&&(j=(/<(.*)>/.exec(j)||[])[1]),j?(a=j,e()):b(f,d)})}()}e.User=function(){this.repos=function(a){h("/user/repos?type=all&per_page=1000&sort=updated",function(b,c){a(b,c)})},this.keys=function(a,b){g("GET","/users/"+a+"/keys",null,function(a,c){b(a,c)})},this.orgs=function(a){g("GET","/user/orgs",null,function(b,c){a(b,c)})},this.gists=function(a){g("GET","/gists",null,function(b,c){a(b,c)})},this.notifications=function(a){g("GET","/notifications",null,function(b,c){a(b,c)})},this.show=function(a,b){var c=a?"/users/"+a:"/user";g("GET",c,null,function(a,c){b(a,c)})},this.userRepos=function(a,b){h("/users/"+a+"/repos?type=all&per_page=1000&sort=updated",function(a,c){b(a,c)})},this.userGists=function(a,b){g("GET","/users/"+a+"/gists",null,function(a,c){b(a,c)})},this.orgRepos=function(a,b){h("/orgs/"+a+"/repos?type=all&&page_num=1000&sort=updated&direction=desc",function(a,c){b(a,c)})},this.follow=function(a,b){g("PUT","/user/following/"+a,null,function(a,c){b(a,c)})},this.unfollow=function(a,b){g("DELETE","/user/following/"+a,null,function(a,c){b(a,c)})}},e.Repository=function(a){function b(a,b){return a===i.branch&&i.sha?b(null,i.sha):(f.getRef("heads/"+a,function(c,d){i.branch=a,i.sha=d,b(c,d)}),void 0)}var d=a.name,e=a.user,f=this,h="/repos/"+e+"/"+d,i={branch:null,sha:null};this.getRef=function(a,b){g("GET",h+"/git/refs/"+a,null,function(a,c){return a?b(a):(b(null,c.object.sha),void 0)})},this.createRef=function(a,b){g("POST",h+"/git/refs",a,b)},this.deleteRef=function(b,c){g("DELETE",h+"/git/refs/"+b,a,c)},this.createRepo=function(a,b){g("POST","/user/repos",a,b)},this.deleteRepo=function(b){g("DELETE",h,a,b)},this.listTags=function(a){g("GET",h+"/tags",null,function(b,c){return b?a(b):(a(null,c),void 0)})},this.listPulls=function(a,b){g("GET",h+"/pulls"+(a?"?state="+a:""),null,function(a,c){return a?b(a):(b(null,c),void 0)})},this.getPull=function(a,b){g("GET",h+"/pulls/"+a,null,function(a,c){return a?b(a):(b(null,c),void 0)})},this.compare=function(a,b,c){g("GET",h+"/compare/"+a+"..."+b,null,function(a,b){return a?c(a):(c(null,b),void 0)})},this.listBranches=function(a){g("GET",h+"/git/refs/heads",null,function(b,d){return b?a(b):(a(null,c.map(d,function(a){return c.last(a.ref.split("/"))})),void 0)})},this.getBlob=function(a,b){g("GET",h+"/git/blobs/"+a,null,b,"raw")},this.getSha=function(a,b,d){return""===b?f.getRef("heads/"+a,d):(f.getTree(a+"?recursive=true",function(a,e){if(a)return d(a);var f=c.select(e,function(a){return a.path===b})[0];d(null,f?f.sha:null)}),void 0)},this.getTree=function(a,b){g("GET",h+"/git/trees/"+a,null,function(a,c){return a?b(a):(b(null,c.tree),void 0)})},this.postBlob=function(a,b){"string"==typeof a&&(a={content:a,encoding:"utf-8"}),g("POST",h+"/git/blobs",a,function(a,c){return a?b(a):(b(null,c.sha),void 0)})},this.updateTree=function(a,b,c,d){var e={base_tree:a,tree:[{path:b,mode:"100644",type:"blob",sha:c}]};g("POST",h+"/git/trees",e,function(a,b){return a?d(a):(d(null,b.sha),void 0)})},this.postTree=function(a,b){g("POST",h+"/git/trees",{tree:a},function(a,c){return a?b(a):(b(null,c.sha),void 0)})},this.commit=function(b,c,d,e){var f={message:d,author:{name:a.username},parents:[b],tree:c};g("POST",h+"/git/commits",f,function(a,b){return i.sha=b.sha,a?e(a):(e(null,b.sha),void 0)})},this.updateHead=function(a,b,c){g("PATCH",h+"/git/refs/heads/"+a,{sha:b},function(a){c(a)})},this.show=function(a){g("GET",h,null,a)},this.contents=function(a,b,c,d){return g("GET",(h+"/contents/"+("string"==typeof b?b:"/")+"?ref="+a).replace("//","/"),null,c,"raw",d)},this.fork=function(a){g("POST",h+"/forks",null,a)},this.branch=function(a,b,c){2===arguments.length&&"function"==typeof arguments[1]&&(c=b,b=a,a="master"),this.getRef("heads/"+a,function(a,d){return a&&c?c(a):(f.createRef({ref:"refs/heads/"+b,sha:d},c),void 0)})},this.createPullRequest=function(a,b){g("POST",h+"/pulls",a,b)},this.listHooks=function(a){g("GET",h+"/hooks",null,a)},this.getHook=function(a,b){g("GET",h+"/hooks/"+a,null,b)},this.createHook=function(a,b){g("POST",h+"/hooks",a,b)},this.editHook=function(a,b,c){g("PATCH",h+"/hooks/"+a,b,c)},this.deleteHook=function(a,b){g("DELETE",h+"/hooks/"+a,null,b)},this.read=function(a,b,c){f.getSha(a,b,function(a,b){return b?(f.getBlob(b,function(a,d){c(a,d,b)}),void 0):c("not found",null)})},this.remove=function(a,b,c,d,e){g("DELETE",h+"/contents/"+b+"?sha="+c+"&message="+d,null,e)},this.move=function(a,d,e,g){b(a,function(b,h){f.getTree(h+"?recursive=true",function(b,i){c.each(i,function(a){a.path===d&&(a.path=e),"tree"===a.type&&delete a.sha}),f.postTree(i,function(b,c){f.commit(h,c,"Deleted "+d,function(b,c){f.updateHead(a,c,function(a){g(a)})})})})})},this.write=function(a,c,d,e,g){b(a,function(b,h){return b?g(b):(f.postBlob(d,function(b,d){return b?g(b):(f.updateTree(h,c,d,function(b,c){return b?g(b):(f.commit(h,c,e,function(b,c){return b?g(b):(f.updateHead(a,c,g),void 0)}),void 0)}),void 0)}),void 0)})},this.getCommits=function(a,b){a=a||{};var c=h+"/commits",d=[];if(a.sha&&d.push("sha="+encodeURIComponent(a.sha)),a.path&&d.push("path="+encodeURIComponent(a.path)),a.since){var e=a.since;e.constructor===Date&&(e=e.toISOString()),d.push("since="+encodeURIComponent(e))}if(a.until){var f=a.until;f.constructor===Date&&(f=f.toISOString()),d.push("until="+encodeURIComponent(f))}d.length>0&&(c+="?"+d.join("&")),g("GET",c,null,b)}},e.Gist=function(a){var b=a.id,c="/gists/"+b;this.read=function(a){g("GET",c,null,function(b,c){a(b,c)})},this.create=function(a,b){g("POST","/gists",a,b)},this.delete=function(a){g("DELETE",c,null,function(b,c){a(b,c)})},this.fork=function(a){g("POST",c+"/fork",null,function(b,c){a(b,c)})},this.update=function(a,b){g("PATCH",c,a,function(a,c){b(a,c)})},this.star=function(a){g("PUT",c+"/star",null,function(b,c){a(b,c)})},this.unstar=function(a){g("DELETE",c+"/star",null,function(b,c){a(b,c)})},this.isStarred=function(a){g("GET",c+"/star",null,function(b,c){a(b,c)})}},e.Issue=function(a){var b="/repos/"+a.user+"/"+a.repo+"/issues";this.list=function(a,c){g("GET",b,a,function(a,b){c(a,b)})}},this.getIssues=function(a,b){return new e.Issue({user:a,repo:b})},this.getRepo=function(a,b){return new e.Repository({user:a,name:b})},this.getUser=function(){return new e.User},this.getGist=function(a){return new e.Gist({id:a})}};"undefined"!=typeof exports?module.exports=e:window.Github=e}).call(this);